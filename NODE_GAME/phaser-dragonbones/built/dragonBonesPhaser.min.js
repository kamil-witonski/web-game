/**
 * git: https://github.com/raksa/phaser-dragonbones
 */

var __extends=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,h){b.__proto__=h}||function(b,h){for(var a in h)h.hasOwnProperty(a)&&(b[a]=h[a])};return function(g,h){function a(){this.constructor=g}b(g,h);g.prototype=null===h?Object.create(h):(a.prototype=h.prototype,new a)}}(),Rift;
(function(b){b.IMAGE=2;b.JSON=11;b.VERSION="0.1";var g=function(e){function d(a,c){var d=e.call(this,a,c)||this;d.Suffix="DragonBonesPlugin";d.ImageSuffix="_Image_"+d.Suffix;d.TextureSuffix="_TextureMap_"+d.Suffix;d.BonesSuffix="_Bones_"+d.Suffix;return d}__extends(d,e);d.prototype.addResourceByNames=function(d,e,b,k){this.addResources(d,[new a(c.Image,k),new a(c.TextureMap,b),new a(c.Bones,e)])};d.prototype.addResources=function(a,c){for(var d=0;d<c.length;d++)this.addResource(a,c[d])};d.prototype.addResource=
function(a,c){a=a.toLowerCase();var e=!1,f;for(f in d.objDictionary)if(f==a){0==d.objDictionary[f].resources.filter(function(a){return a.type===c.type}).length&&d.objDictionary[f].resources.push(c);e=!0;break}e||(d.objDictionary[a]=new h(this.game,[]),d.objDictionary[a].resources.push(c))};d.prototype.loadResources=function(){for(var a in d.objDictionary)for(var e=0,b=d.objDictionary[a].resources;e<b.length;e++){var k=b[e];if(!k.loaded){switch(k.type){case c.Image:this.game.load.image(a+this.ImageSuffix,
k.filePath);break;case c.TextureMap:this.game.load.json(a+this.TextureSuffix,k.filePath);break;case c.Bones:this.game.load.json(a+this.BonesSuffix,k.filePath)}k.loaded=!0}}};d.prototype.createFactoryItem=function(a){a=a.toLowerCase();for(var e in d.objDictionary)if(!a||e==a){a=new h(this.game,d.objDictionary[e].resources);for(var f=null,k=null,n=null,g=0;g<a.resources.length;g++)switch(a.resources[g].type){case c.Image:f=this.game.cache.getItem(e+this.ImageSuffix,b.IMAGE).data;break;case c.TextureMap:k=
this.game.cache.getItem(e+this.TextureSuffix,b.JSON).data;break;case c.Bones:n=this.game.cache.getItem(e+this.BonesSuffix,b.JSON).data}a.skeleton=a.factory.parseDragonBonesData(n);a.factory.parseTextureAtlasData(k,f);return a}return null};d.prototype.getArmature=function(a,c){var e=this.createFactoryItem(a);null==c&&(c=e.skeleton.armatureNames[0]);var d=e.factory.buildArmatureDisplay(c);e.armature=d;this.refreshClock();return e.armature};d.prototype.refreshClock=function(){var a=!1,c=dragonBones.PhaserFactory._clockHandler;
this.game.time.events.events.forEach(function(e,d,b){e.callback==c&&(a=!0)});a||this.game.time.events.loop(20,dragonBones.PhaserFactory._clockHandler,dragonBones.PhaserFactory)};return d}(Phaser.Plugin);g.objDictionary={};b.DragonBonesPlugin=g;var h=function(){return function(a,c){this.factory=new dragonBones.PhaserFactory(null,a);this.resources=c}}(),a=function(){return function(a,c){this.loaded=!1;this.type=a;this.filePath=c}}();b.Resource=a;var c;(function(a){a[a.Image=0]="Image";a[a.TextureMap=
1]="TextureMap";a[a.Bones=2]="Bones"})(c=b.ResType||(b.ResType={}))})(Rift||(Rift={}));PIXI.Sprite.prototype.setTexture=function(b,g){void 0!==g&&this.texture.baseTexture.destroy();this.texture=b;this.texture.baseTexture.skipRender=!1;this.texture.valid=!0;this.cachedTint=-1};
PIXI.Sprite.prototype.getBounds=function(b){var g=b&&b instanceof PIXI.DisplayObject,h=!0;g?h=b instanceof PIXI.DisplayObjectContainer?b.contains(this):!1:b=this;var a;if(g){var c=b.worldTransform;b.worldTransform=PIXI.identityMatrix;for(a=0;a<b.children.length;a++)b.children[a].updateTransform()}var e=Infinity,d=Infinity,f=-Infinity,l=-Infinity,m,k,n=!1;for(a=0;a<this.children.length;a++)this.children[a].visible&&(n=!0,m=this.children[a].getBounds(),e=e<m.x?e:m.x,d=d<m.y?d:m.y,k=m.width+m.x,m=m.height+
m.y,f=f>k?f:k,l=l>m?l:m);k=this._bounds;if(!n){k=new PIXI.Rectangle;var r=k.x,f=k.width+k.x,l=k.y,n=k.height+k.y;a=this.worldTransform;var p=a.a,q=a.b,t=a.c,u=a.d,v=a.tx,w=a.ty,e=p*f+t*n+v,d=u*n+q*f+w;a=p*r+t*n+v;n=u*n+q*r+w;m=p*r+t*l+v;r=u*l+q*r+w;p=p*f+t*l+v;q=u*l+q*f+w;f=e;l=d;e=a<e?a:e;e=m<e?m:e;e=p<e?p:e;d=n<d?n:d;d=r<d?r:d;d=q<d?q:d;f=a>f?a:f;f=m>f?m:f;f=p>f?p:f;l=n>l?n:l;l=r>l?r:l;l=q>l?q:l}k.x=e;k.y=d;k.width=f-e;k.height=l-d;if(g)for(b.worldTransform=c,a=0;a<b.children.length;a++)b.children[a].updateTransform();
h||(b=b.getBounds(),k.x-=b.x,k.y-=b.y);return k};var dragonBones;
(function(b){var g=function(h){function a(a){var c=h.call(this,a,0,0,0)||this;c.maxX=0;c.maxY=0;c.game=a;return c}__extends(a,h);a.prototype.SetBounds=function(a){if(a||this.maxX<this.getBounds().width)this.maxX=this.getBounds().width;if(a||this.maxY<this.getBounds().height)this.maxY=this.getBounds().height;this.body.setSize(this.maxX/2,this.maxX/2,this.maxY,0)};a.prototype._onClear=function(){this._armature=null;this._debugDrawer&&(this._debugDrawer.destroy(!0),this._debugDrawer=null);this.destroy(!0)};
a.prototype._dispatchEvent=function(a){};a.prototype._debugDraw=function(a){this._debugDrawer||(this._debugDrawer=new Phaser.Graphics(this.game));if(a){this.addChild(this._debugDrawer);this._debugDrawer.clear();a=this._armature.getBones();for(var c=0,d=a.length;c<d;++c){var b=a[c],l=Math.max(b.length,5),m=b.globalTransformMatrix.tx,k=b.globalTransformMatrix.ty,h=m+b.globalTransformMatrix.a*l,l=k+b.globalTransformMatrix.b*l;this._debugDrawer.lineStyle(1,b.ik?16711680:65280,.5);this._debugDrawer.moveTo(m,
k);this._debugDrawer.lineTo(h,l)}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)};a.prototype.hasEvent=function(a){return!1};a.prototype.addEvent=function(a,e,d){};a.prototype.removeEvent=function(a,e,d){};a.prototype.advanceTimeBySelf=function(a){a?b.PhaserFactory._clock.add(this._armature):b.PhaserFactory._clock.remove(this._armature)};a.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=
null)};Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0});return a}(Phaser.Sprite);b.PhaserArmatureDisplay=g})(dragonBones||(dragonBones={}));
(function(b){var g=function(h){function a(c,e){void 0===c&&(c=null);var d=h.call(this,c)||this;d.game=e;a._eventManager||(a._eventManager=new b.PhaserArmatureDisplay(e),a._clock=new b.WorldClock);return d}__extends(a,h);a._clockHandler=function(c){a._clock.advanceTime(-1)};Object.defineProperty(a,"factory",{get:function(c){a._factory||(a._factory=new a(null,c));return a._factory},enumerable:!0,configurable:!0});a.prototype._generateTextureAtlasData=function(a,e){a?a.texture=e:a=b.BaseObject.borrowObject(b.PhaserTextureAtlasData);
return a};a.prototype._generateArmature=function(c){var e=b.BaseObject.borrowObject(b.Armature),d=new b.PhaserArmatureDisplay(this.game);e._armatureData=c.armature;e._skinData=c.skin;e._animation=b.BaseObject.borrowObject(b.Animation);e._display=d;e._eventManager=a._eventManager;d._armature=e;e._animation._armature=e;e.animation.animations=c.armature.animations;return e};a.prototype._generateSlot=function(a,e){var c=b.BaseObject.borrowObject(b.PhaserSlot),f=e.slot,l=[];c.game=this.game;c.name=f.name;
c._rawDisplay=new Phaser.Sprite(this.game,0,0);c._meshDisplay=null;for(var m=0,k=e.displays.length;m<k;++m){var h=e.displays[m];switch(h.type){case 0:h.texture||(h.texture=this._getTextureData(a.dataName,h.name));l.push(c._rawDisplay);break;case 2:h.texture||(h.texture=this._getTextureData(a.dataName,h.name));l.push(c._meshDisplay);break;case 1:var g=this.buildArmature(h.name,a.dataName);if(g){if(!c.inheritAnimation){var p=0<f.actions.length?f.actions:g.armatureData.actions;if(0<p.length)for(var q=
0,t=p.length;q<t;++q)g._bufferAction(p[q]);else g.animation.play()}h.armature=g.armatureData}l.push(g);break;default:l.push(null)}}c._setDisplayList(l);return c};a.prototype.buildArmatureDisplay=function(a,e,d){void 0===e&&(e=null);void 0===d&&(d=null);(a=(a=this.buildArmature(a,e,d))?a._display:null)&&a.advanceTimeBySelf(!0);return a};a.prototype.getTextureDisplay=function(a,e){void 0===e&&(e=null);var c=this._getTextureData(e,a);if(c){if(!c.texture){var b=c.parent.texture,h=new Phaser.Rectangle(0,
0,c.region.width,c.region.height);c.texture=new PIXI.Texture(b,c.region,h)}return new Phaser.Sprite(this.game,0,0,c.texture)}return null};Object.defineProperty(a.prototype,"soundEventManater",{get:function(){return a._eventManager},enumerable:!0,configurable:!0});return a}(b.BaseFactory);g._factory=null;g._eventManager=null;g._clock=null;b.PhaserFactory=g})(dragonBones||(dragonBones={}));
(function(b){var g=function(b){function a(){return b.call(this)||this}__extends(a,b);a.toString=function(){return"[class dragonBones.PhaserSlot]"};a.prototype.set_game=function(){};a.prototype._onClear=function(){b.prototype._onClear.call(this);this._renderDisplay=null};a.prototype._initDisplay=function(a){};a.prototype._disposeDisplay=function(a){a.destroy()};a.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay};a.prototype._addDisplay=function(){this._armature._display.addChild(this._renderDisplay)};
a.prototype._replaceDisplay=function(a){var c=this._armature._display;c.addChild(this._renderDisplay);c.swapChildren(this._renderDisplay,a);c.removeChild(a)};a.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)};a.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible};a.prototype._updateBlendMode=function(){};a.prototype._updateColor=function(){this._renderDisplay.alpha=this._colorTransform.alphaMultiplier};a.prototype._updateFilters=
function(){};a.prototype._updateFrame=function(){var a=this._renderDisplay;if(this._display){var b=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,d=(this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null)||b,f=d.texture;if(f){var h=f.parent.texture;if(!f.texture&&h){var g=new PIXI.Rectangle(0,0,f.region.width,f.region.height);f.texture=new PIXI.Texture(h,f.region,f.region,g,f.rotated)}g=
this._armature._replacedTexture||f.texture;this._updatePivot(b,d,f);g&&g.frame&&(a.setTexture(g),a.width=g.frame.width,a.height=g.frame.height,a.texture.baseTexture.skipRender=!1);g.baseTexture.resolution=1;g.baseTexture.source=h;this._updateVisible();return}}this._pivotY=this._pivotX=0;a.visible=!1;a.texture=null;a.x=this.origin.x;a.y=this.origin.y};a.prototype._updateMesh=function(){var a=0<this._ffdVertices.length;if(this._meshData.skinned)for(var a=0,b=this._meshData.vertices.length;a<b;a+=2)for(var d=
0,f=this._meshData.boneIndices[a/2].length;d<f;++d);else if(a)for(a=0,b=this._meshData.vertices.length;a<b;a+=2);};a.prototype._updateTransform=function(){this._renderDisplay.x=this.global.x;this._renderDisplay.y=this.global.y;this._renderDisplay.rotation=this.global.skewX;this._renderDisplay.scale.x=this.global.scaleX;this._renderDisplay.scale.y=this.global.scaleY;this._renderDisplay.pivot.x=this._pivotX;this._renderDisplay.pivot.y=this._pivotY};return a}(b.Slot);b.PhaserSlot=g})(dragonBones||(dragonBones=
{}));
(function(b){var g=function(a){function c(){return a.call(this)||this}__extends(c,a);c.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"};c.prototype._onClear=function(){a.prototype._onClear.call(this);this.texture&&(this.texture=null)};c.prototype.generateTextureData=function(){return b.BaseObject.borrowObject(h)};return c}(b.TextureAtlasData);b.PhaserTextureAtlasData=g;var h=function(a){function b(){return a.call(this)||this}__extends(b,a);b.toString=function(){return"[class dragonBones.PhaserTextureData]"};b.prototype._onClear=
function(){a.prototype._onClear.call(this);this.texture&&(this.texture.destroy(!1),this.texture=null)};return b}(b.TextureData);b.PhaserTextureData=h})(dragonBones||(dragonBones={}));